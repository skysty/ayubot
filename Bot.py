import telebot
from telebot import types
API_TOKEN = '2098535146:AAHg5Jqi3xHCH14VfbE_CUvFmhkrP6sPkao'
BOT_URL='https://sosayu.herokuapp.com/'
bot = telebot.TeleBot(API_TOKEN)

knownUsers = []  # todo: save these in a file,
userStep = {}    # so they won't reset every time the bot restarts

commands = {  # command description used in the "help" command
    'start'       : '–ë–æ—Ç—Ç—ã “õ–æ–ª–¥–∞–Ω—É “Ø—à—ñ–Ω',
    'help'        : '“ö–æ–ª –∂–µ—Ç—ñ–º–¥—ñ –∫–æ–º–∞–Ω–¥–∞–ª–∞—Ä —Ç—É—Ä–∞–ª—ã –∞“õ–ø–∞—Ä–∞—Ç –±–µ—Ä–µ–¥—ñ'
}

def get_user_step(uid):
    if uid in userStep:
        return userStep[uid]
    else:
        knownUsers.append(uid)
        userStep[uid] = 0
        print("“ö–æ–ª–¥–∞–Ω–±–∞“ì–∞–Ω –∂–∞“£–∞ –ø–∞–π–¥–∞–ª–∞–Ω—É—à—ã –∞–Ω—ã“õ—Ç–∞–ª–¥—ã –±–æ—Ç—Ç—ã “õ–æ–ª–¥–∞–Ω—É “Ø—à—ñ–Ω \"/start\" –∫–æ–º–∞–Ω–¥–∞—Å—ã–Ω –±–∞—Å—ã“£—ã–∑")
        return 0


@bot.message_handler(commands=['start'])
def command_start(message):
    markup = types.ReplyKeyboardMarkup(row_width=1,resize_keyboard=True)
    item1=types.KeyboardButton('‚õëÔ∏è“ö–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–∫ –µ—Ä–µ–∂–µ–ª–µ—Ä—ñ')
    item2=types.KeyboardButton('‚ÑπÔ∏è –ü–∞–π–¥–∞–ª–∞–Ω—É –µ—Ä–µ–∂–µ—Å—ñ')
    item3=types.KeyboardButton('üõë SOS',request_location=True)
    item4=types.KeyboardButton('üìûCall center')

    markup.add(item1,item2,item3,item4)
    bot.send_message(message.chat.id,'C”ô–ª–µ–º–µ—Çc—ñ–∑ –±–µ, {0.first_name}!\n–ë“±–ª —á–∞—Ç-–±–æ—Ç “ö–æ–∂–∞ –ê—Ö–º–µ—Ç –Ø—Å–∞—É–∏ –∞—Ç—ã–Ω–¥–∞“ì—ã –•–∞–ª—ã“õ–∞—Ä–∞–ª—ã“õ “õ–∞–∑–∞“õ-—Ç“Ø—Ä—ñ–∫  —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ñ–Ω—ñ“£ “õ—ã–∑–º–µ—Ç–∫–µ—Ä–ª–µ—Ä—ñ –º–µ–Ω –æ“õ—ã—Ç—É—à—ã–ª–∞—Ä—ã –∂”ô–Ω–µ —Å—Ç—É–¥–µ–Ω—Ç—Ç–µ—Ä—ñ–Ω —Ç”©—Ç–µ–Ω—à–µ –∂–∞“ì–¥–∞–π–¥—ã –∞–ª–¥—ã–Ω –∞–ª–∞ —Ö–∞–±–∞—Ä–ª–∞—É “Ø—à—ñ–Ω “õ“±—Ä—ã–ª–¥—ã. \n\n –ú–µ–Ω —Å—ñ–∑–≥–µ “õ–∞–Ω–¥–∞–π –∫”©–º–µ–∫ –±–µ—Ä–µ –∞–ª–∞—Ç—ã–Ω—ã–º–¥—ã –º”ô–∑—ñ—Ä–¥–µ–Ω —Ç–∞“£–¥–∞–π—Å—ã–∑'.format(message.from_user), reply_markup=markup)
          
@bot.message_handler(content_types=["location","text"])
def bot_message(message):
    if message.chat.type =='private':
        if message.text =='‚õëÔ∏è“ö–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–∫ –µ—Ä–µ–∂–µ–ª–µ—Ä—ñ':
            markup = types.ReplyKeyboardMarkup(row_width=1,resize_keyboard=True)
            item1=types.KeyboardButton('‚ô®Ô∏è”®—Ä—Ç “õ–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–∫ –µ—Ä–µ–∂–µ–ª–µ—Ä—ñ')
            item2=types.KeyboardButton('üë©‚Äçüíª–¢–µ—Ä—Ä–æ—Ä–∏–∑–º–Ω–µ–Ω —Å–∞“õ—Ç–∞–Ω—É –∂–æ–ª–¥–∞—Ä—ã/–∂–∞–¥–Ω–∞–º–∞')
            item3=types.KeyboardButton('‚¨ÖÔ∏è –ê—Ä—Ç“õ–∞')
            markup.add(item1,item2,item3) 

            bot.send_message(message.chat.id, '‚õëÔ∏è“ö–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–∫ –µ—Ä–µ–∂–µ–ª–µ—Ä—ñ', reply_markup=markup)
        elif message.text =='üõë SOS':
            bot.send_message(message.chat.id, 'Help me!')
            if message.location is not None:
                print(message.location)
                print("latitude: %s; longitude: %s" % (message.location.latitude, message.location.longitude))
        elif message.text =='üìûCall center':
            bot.send_message(message.chat.id, '+77017659784\n +77015554689\n ”®—Ä—Ç —Å”©–Ω–¥—ñ—Ä—É—à—ñ–ª–µ—Ä ‚Äî 101\n –ü–æ–ª–∏—Ü–∏—è ‚Äî 102\n–ñ–µ–¥–µ–ª –∂”ô—Ä–¥–µ–º ‚Äî 103\n–ì–∞–∑ –∞–ø–∞—Ç—ã–Ω–∞–Ω “õ“±—Ç–∞“õ—Ä—É “õ—ã–∑–º–µ—Ç—ñ ‚Äî 104\n“ö“±—Ç“õ–∞—Ä—É “õ—ã–∑–º–µ—Ç—ñ ‚Äî 109')
        elif message.text =='‚ÑπÔ∏è –ü–∞–π–¥–∞–ª–∞–Ω—É –µ—Ä–µ–∂–µ—Å—ñ':
            bot.send_message(message.chat.id, '"SOS.Ayu.bot "(–±“±–¥–∞–Ω ”ô—Ä—ñ-SOS.Ayu) —Å–∞–Ω–¥—ã“õ –¥–∞–±—ã–ª —Ç“Ø–π–º–µ—Å—ñ–Ω –ø–∞–π–¥–∞–ª–∞–Ω—É –µ—Ä–µ–∂–µc—ñ:\n\n1. SOS.Ayu –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç—Ç–µ—Ä—ñ –º–µ–Ω “õ—ã–∑–º–µ—Ç–∫–µ—Ä–ª–µ—Ä—ñ–Ω, —Å–æ–Ω–¥–∞–π ‚Äì –∞“õ —Å—Ç—É–¥–µ–Ω—Ç—Ç–µ—Ä –º–µ–Ω “õ—ã–∑–º–µ—Ç–∫–µ—Ä–ª–µ—Ä–¥—ñ“£ –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—Ç—ñ —Ç”©—Ç–µ–Ω—à–µ –æ“õ–∏“ì–∞ (–∂–µ—Ä —Å—ñ–ª–∫—ñ–Ω—ñ—Å—ñ, —Å—É —Ç–∞—Å“õ—ã–Ω—ã, ”©–∑–≥–µ –¥–µ –¥“Ø–ª–µ–π –∑—ñ–ª–∑–∞–ª–∞, —Ç–µ—Ä—Ä–æ—Ä–∏—Å—Ç—ñ–∫ –∞–∫—Ç(—Ç–µ—Ä) ‚Äì –±“±–¥–∞–Ω ”ô—Ä—ñ-–¢–û) —Ç—É—Ä–∞–ª—ã —à“±“ì—ã–ª —Ö–∞–±–∞—Ä–¥–∞—Ä –µ—Ç—É–≥–µ –∞—Ä–Ω–∞–ª“ì–∞–Ω.\n\n2. –¢–û —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞:\n\n(1) —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç—ñ / “õ—ã–∑–º–µ—Ç–∫–µ—Ä—ñ–Ω–µ–Ω –∞–ª“ì–∞–Ω –∂–∞“ì–¥–∞–π–¥–∞: —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—Ç—ñ“£ –∂–∞—É–∞–ø—Ç—ã “õ—ã–∑–º–µ—Ç–∫–µ—Ä–ª–µ—Ä—ñ, —Ç–∏—ñ—Å—Ç—ñ —à–∞—Ä–∞–ª–∞—Ä “õ–∞–±—ã–ª–¥–∞–π–¥—ã;\n(2) —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—Ç–µ–Ω –∞–ª“ì–∞–Ω –∂–∞“ì–¥–∞–π–¥–∞: —Å—Ç—É–¥–µ–Ω—Ç—Ç–µ—Ä –º–µ–Ω “õ—ã–∑–º–µ—Ç–∫–µ—Ä–ª–µ—Ä —Ö–∞–±–∞—Ä–ª–∞–º–∞–¥–∞ –∫”©—Ä—Å–µ—Ç—ñ–ª–≥–µ–Ω —à–∞—Ä–∞–ª–∞—Ä–¥—ã “õ–∞–±—ã–ª–¥–∞—É“ì–∞ –º—ñ–Ω–¥–µ—Ç—Ç—ñ.\n\n3. SOS.Ayu-–¥—ã –∫–µ–ª–µ—Å—ñ –∂–∞“ì–¥–∞–π–ª–∞—Ä–¥–∞ “õ–æ–ª–¥–∞–Ω—É “õ–∞–∂–µ—Ç: —Å—ñ–∑–≥–µ –Ω–µ–º–µ—Å–µ –±–∞—Å“õ–∞ —Å—Ç—É–¥–µ–Ω—Ç–∫–µ/“õ—ã–∑–º–µ—Ç–∫–µ—Ä–≥–µ –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∞—É–º–∞“ì—ã–Ω–¥–∞ —Ç—ñ–∫–µ–ª–µ–π —à–∞–±—É—ã–ª –∂–∞—Å–∞“ì–∞–Ω –∫–µ–∑–¥–µ; –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∫–µ –º–∞—Ç–µ—Ä–∏–∞–ª–¥—ã“õ –∑–∏—è–Ω –∫–µ–ª—Ç—ñ—Ä–≥–µ–Ω –∫–µ–∑–¥–µ; –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—Ç–µ ”©—Ä—Ç —Ç—É—ã–Ω–¥–∞“ì–∞–Ω –∫–µ–∑–¥–µ; –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∫–µ —ñ—Ä–≥–µ–ª–µ—Å –∞—É–º–∞“õ—Ç–∞ –∫“Ø–¥—ñ–∫—Ç—ñ –∑–∞—Ç—Ç–∞—Ä —Ç–∞–±—ã–ª“ì–∞–Ω –∫–µ–∑–¥–µ; –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª–¥—ã“õ “õ“±–Ω–¥—ã–ª—ã“õ—Ç–∞—Ä–¥—ã “±—Ä–ª–∞—É“ì–∞ ”ô—Ä–µ–∫–µ—Ç –∂–∞—Å–∞“ì–∞–Ω –∫–µ–∑–¥–µ; –±–∞—Å“õ–∞ –¢–û —Ç—É—ã–Ω–¥–∞“ì–∞–Ω –∫–µ–∑–¥–µ.\n4. SOS.Ayu-–¥—ã “õ–∞–∂–µ—Ç—Å—ñ–∑ –ø–∞–π–¥–∞–ª–∞–Ω—É“ì–∞ —Ç—ã–π—ã–º —Å–∞–ª—ã–Ω–∞–¥—ã. –û—Å—ã —Ç—ã–π—ã–º–¥—ã –±“±–∑—É“ì–∞ –∂–æ–ª –±–µ—Ä–≥–µ–Ω –∞–¥–∞–º–¥–∞—Ä —Ç”ô—Ä—Ç—ñ–ø—Ç—ñ–∫ –∂”ô–Ω–µ ”©–∑–≥–µ –¥–µ –∂–∞—É–∞–ø—Ç—ã–ª—ã“õ“õ–∞ —Ç–∞—Ä—Ç—ã–ª–∞–¥—ã.\n5. SOS.Ayu-–¥—ã –∫–µ–∑–¥–µ–π—Å–æ“õ –ø–∞–π–¥–∞–ª–∞–Ω“ì–∞–Ω –∂–∞“ì–¥–∞–π–¥–∞ "SOS" —Ö–∞–±–∞—Ä–ª–∞–º–∞—Å—ã–Ω –∂—ñ–±–µ—Ä–≥–µ–Ω —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç—ñ –Ω–µ–º–µ—Å–µ “õ—ã–∑–º–µ—Ç–∫–µ—Ä—ñ –±“±–ª —Ç—É—Ä–∞–ª—ã Call-center-–≥–µ “õ–æ“£—ã—Ä–∞—É —à–∞–ª—É –∞—Ä“õ—ã–ª—ã —Ö–∞–±–∞—Ä–ª–∞—É—ã —Ç–∏—ñ—Å.')
        elif message.text =='‚¨ÖÔ∏è –ê—Ä—Ç“õ–∞':
            markup = types.ReplyKeyboardMarkup(row_width=1,resize_keyboard=True)
            item1=types.KeyboardButton('‚õëÔ∏è“ö–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–∫ –µ—Ä–µ–∂–µ–ª–µ—Ä—ñ')
            item2=types.KeyboardButton('‚ÑπÔ∏è –ü–∞–π–¥–∞–ª–∞–Ω—É –µ—Ä–µ–∂–µ—Å—ñ')
            item3=types.KeyboardButton('üõë SOS',request_location=True)
            item4=types.KeyboardButton('üìûCall center')

            markup.add(item1,item2,item3,item4)
            bot.send_message(message.chat.id, '‚¨ÖÔ∏è –ê—Ä—Ç“õ–∞', reply_markup=markup)
        elif message.text =='‚ô®Ô∏è”®—Ä—Ç “õ–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–∫ –µ—Ä–µ–∂–µ–ª–µ—Ä—ñ':
            bot.send_message(message.chat.id, '‚ô®Ô∏è”®—Ä—Ç —à—ã“õ“õ–∞–Ω –∂–∞“ì–¥–∞–π–¥–∞  –Ω–µ —ñ—Å—Ç–µ—É –∫–µ—Ä–µ–∫?\nüë®‚Äçüöí–ó–∞—Ä–¥–∞–ø —à–µ–∫–∫–µ–Ω–¥–µ—Ä–≥–µ –∞–ª“ì–∞—à“õ—ã –∫”©–º–µ–∫\n‚ùì–ù–µ —ñ—Å—Ç–µ—É–≥–µ –±–æ–ª–º–∞–π–¥—ã?\nüî•”®—Ä—Ç—Ç—ñ“£ –∞–ª–¥—ã–Ω –∞–ª—É “Ø—à—ñ–Ω')
        elif message.text =='üë©‚Äçüíª–¢–µ—Ä—Ä–æ—Ä–∏–∑–º–Ω–µ–Ω —Å–∞“õ—Ç–∞–Ω—É –∂–æ–ª–¥–∞—Ä—ã/–∂–∞–¥–Ω–∞–º–∞':
            bot.send_message(message.chat.id, 'üëÆ‚Äç‚ôÇÔ∏è–¢–µ—Ä—Ä–æ—Ä–∏—Å—Ç—ñ–∫ –∞–∫—Ç—ñ–ª–µ—Ä–¥—ñ –±–æ–ª–¥—ã—Ä–º–∞—É –∂”©–Ω—ñ–Ω–¥–µ–≥—ñ –∂–∞–¥–Ω–∞–º–∞\nüëÆ‚Äç‚ôÇÔ∏è–ö“Ø–¥—ñ–∫—Ç—ñ —Ç“±–ª“ì–∞–ª–∞—Ä–¥—ã –±–∞–π“õ–∞“ì–∞–Ω –∂–∞“ì–¥–∞–π–¥–∞ –∂–∞–¥–Ω–∞–º–∞\nüëÆ‚Äç‚ôÇÔ∏è–ö“Ø–¥—ñ–∫—Ç—ñ –∑–∞—Ç —Ç–∞—É—ã–ø –∞–ª“ì–∞–Ω –∫–µ–∑–¥–µ–≥—ñ –∂–∞–¥–Ω–∞–º–∞\nüëÆ‚Äç‚ôÇÔ∏è–ñ–∞—Ä—ã–ª—ã—Å –∞–π–º–∞“ì—ã–Ω–¥–∞ –Ω–µ–º–µ—Å–µ “ì–∏–º–∞—Ä–∞—Ç—Ç—ã“£ “õ–∏—Ä–∞“ì–∞–Ω “Ø–π—ñ–Ω–¥—ñ–ª–µ—Ä—ñ–Ω—ñ“£ –∞—Ä–∞—Å—ã–Ω–¥–∞ “õ–∞–ª“ì–∞–Ω —Ç“±—Ä“ì—ã–Ω–¥–∞—Ä“ì–∞ –∂–∞–¥–Ω–∞–º–∞\nüëÆ‚Äç‚ôÇÔ∏è –ê–¥–∞–º–¥–∞—Ä–¥—ã –∫–µ–ø—ñ–ª–≥–µ –∞–ª“ì–∞–Ω –∂–∞“ì–¥–∞–π–¥–∞“ì—ã —ñ—Å-“õ–∏–º—ã–ª–¥–∞—Ä –±–æ–π—ã–Ω—à –∂–∞–¥–Ω–∞–º–∞')
bot.enable_save_next_step_handlers(delay=2)
bot.load_next_step_handlers()
bot.polling(none_stop=True)        
